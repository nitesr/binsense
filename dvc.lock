schema: '2.0'
stages:
  download_data:
    cmd: python -m binsense.cli.run_rawdata_downloader
    deps:
    - path: libs/binsense/cli/run_rawdata_downloader.py
      hash: md5
      md5: 4ccf0e383f9e89f307c96d80b2374b2f
      size: 1222
    - path: libs/binsense/dataprep/config.py
      hash: md5
      md5: 5f626681456fb429b0169741a5554c71
      size: 3030
    - path: libs/binsense/dataprep/downloader.py
      hash: md5
      md5: 4458af72b0a2fd615c0a3802716dfee6
      size: 4828
    - path: libs/binsense/dataprep/metadata.py
      hash: md5
      md5: 6322555564a952d07c79324794e22c0e
      size: 8832
    params:
      params.yaml:
        data_download:
          num_workers: 10
    outs:
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 03880bbb676f68cb5975641c70f4c55f
      size: 160334
    - path: data/bin/s3/downloader_mark.dat
      hash: md5
      md5: 017af814f883867126f4f5225ffb4b0b
      size: 10
    - path: data/bin/s3/images
      hash: md5
      md5: b2d5b563d1a18c89545a00fe82da29fc.dir
      size: 267582252
      nfiles: 3875
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 337f8f3657958ad78b3e5ceea9cc0b86
      size: 1934482
    - path: data/bin/s3/metadata
      hash: md5
      md5: 63b4bd975c4ba4b2afddd4f00547969f.dir
      size: 7870101
      nfiles: 3875
  extract_products:
    cmd: python -m binsense.cli.run_extract_products
    deps:
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 03880bbb676f68cb5975641c70f4c55f
      size: 160334
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 337f8f3657958ad78b3e5ceea9cc0b86
      size: 1934482
    - path: libs/binsense/cli/run_extract_products.py
      hash: md5
      md5: f7ec51f578ccd269708caac045d3907b
      size: 973
    - path: libs/binsense/dataprep/config.py
      hash: md5
      md5: 5f626681456fb429b0169741a5554c71
      size: 3030
    outs:
    - path: data/bin/products.csv
      hash: md5
      md5: 074a71e8acf6d4b2a76e1f15f7502ad7
      size: 501680
  owl_handpick_data_split:
    cmd: python -m binsense.cli.owlv2.run_handpick_predataprep1
    deps:
    - path: data/bin/handpicked_bins.txt
      hash: md5
      md5: 26d8a3c66acfd8740fd8b95a06e8ec74
      size: 621
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 03880bbb676f68cb5975641c70f4c55f
      size: 160334
    - path: data/bin/s3/images
      hash: md5
      md5: b2d5b563d1a18c89545a00fe82da29fc.dir
      size: 267582252
      nfiles: 3875
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 337f8f3657958ad78b3e5ceea9cc0b86
      size: 1934482
    - path: libs/binsense/cli/owlv2/run_handpick_predataprep1.py
      hash: md5
      md5: 6f4d70c5cfc983bc407b267e29a10d0c
      size: 8916
    params:
      params.yaml:
        data_split:
          manual_seed: 91634
    outs:
    - path: data/bin/handpick_train_test_dist.png
      hash: md5
      md5: 8ab7e0e22c6af58a7607e5af87e90802
      size: 31647
    - path: data/bin/handpick_train_test_samples.png
      hash: md5
      md5: e228a387b868ffcc9b9fdf89e9cf7c49
      size: 373274
    - path: data/bin/train_test_val_split_item.csv
      hash: md5
      md5: 4e51934f24451b35901c034829618be6
      size: 4952
  owl_handpick_data_preannotate:
    cmd: python -m binsense.cli.owlv2.run_handpick_predataprep2 --device=$TORCH_DEVICE
      --annotate --create_dataset --upload_dataset
    deps:
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 03880bbb676f68cb5975641c70f4c55f
      size: 160334
    - path: data/bin/s3/images
      hash: md5
      md5: b2d5b563d1a18c89545a00fe82da29fc.dir
      size: 267582252
      nfiles: 3875
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 337f8f3657958ad78b3e5ceea9cc0b86
      size: 1934482
    - path: data/bin/train_test_val_split_item.csv
      hash: md5
      md5: 4e51934f24451b35901c034829618be6
      size: 4952
    - path: libs/binsense/cli/owlv2/run_handpick_predataprep2.py
      hash: md5
      md5: 40598dde9628dcff72ea6b35e5de7ea7
      size: 3334
    - path: libs/binsense/dataprep/preannotate.py
      hash: md5
      md5: 464b29115bfe5d80ab8eb8182260e007
      size: 10688
    params:
      params.yaml:
        preannotate:
          batch_size: 8
          dl_workers: 10
    outs:
    - path: data/bin/data_for_annotators.csv
      hash: md5
      md5: 1f8fca0794899da8296dd74d87912b11
      size: 1831874
    - path: data/bin/robo_upload
      hash: md5
      md5: 3e7b0c63026e880f3770aa561c74ef2c.dir
      size: 6385195
      nfiles: 183
    - path: data/bin/sample_preannotated_images.png
      hash: md5
      md5: c9313e9e03576504580914fc9eb935f5
      size: 7091308
  owl_handpick_data_download:
    cmd: python -m binsense.cli.owlv2.run_handpick_dataprep1 --download --api_key=$BINSEG_ROBOFLOW_API_KEY
    deps:
    - path: data/bin/handpick_annotation_available.txt
      hash: md5
      md5: ad1f1ad4dc2f67a8c0442d58870b9499
      size: 62
    - path: libs/binsense/cli/owlv2/run_handpick_dataprep1.py
      hash: md5
      md5: 52e289116be997bd84b987912dc2a111
      size: 4144
    params:
      params.yaml:
        binseg_roboflow:
          workspace: nitesh-c-eszzc
          project: binsense_segments_100
          dataver: 3
    outs:
    - path: data/bin/robo_download
      hash: md5
      md5: ff2585fed24d4830eab8786d6b943a95.dir
      size: 2563510
      nfiles: 185
    - path: data/bin/sample_gt_annotation_images.png
      hash: md5
      md5: b47ec4b34a29d96bd239b3c180b282ab
      size: 604106
  owl_handpick_data_prepare:
    cmd: python -m binsense.cli.owlv2.run_handpick_dataprep2 --validate --copy
    deps:
    - path: data/bin/robo_download
      hash: md5
      md5: ff2585fed24d4830eab8786d6b943a95.dir
      size: 2563510
      nfiles: 185
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 03880bbb676f68cb5975641c70f4c55f
      size: 160334
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 337f8f3657958ad78b3e5ceea9cc0b86
      size: 1934482
    - path: data/bin/train_test_val_split_item.csv
      hash: md5
      md5: 4e51934f24451b35901c034829618be6
      size: 4952
    - path: data/bin/train_test_val_split_item_corrections.csv
      hash: md5
      md5: 0ed0711b92b4109cf550c5282f926845
      size: 81
    - path: libs/binsense/cli/owlv2/run_handpick_dataprep2.py
      hash: md5
      md5: 5da601c2fb68e346821094ef89b8d303
      size: 6710
    outs:
    - path: data/bin/downloaded_data_valid_results.txt
      hash: md5
      md5: b451bd980a937a96f8802aa523d9a046
      size: 123
    - path: data/bin/filtered_dataset
      hash: md5
      md5: e9eac410c3a29cdffeeb31f49d66efa6.dir
      size: 2605489
      nfiles: 183
  owl_handpick_data_genembeds:
    cmd: python -m binsense.cli.owlv2.run_handpick_dataprep3 --generate_embeds --accelerator=$TORCH_DEVICE
    deps:
    - path: data/bin/filtered_dataset
      hash: md5
      md5: e9eac410c3a29cdffeeb31f49d66efa6.dir
      size: 2605489
      nfiles: 183
    - path: libs/binsense/cli/owlv2/run_handpick_dataprep3.py
      hash: md5
      md5: 0d1aa059ba94ad7261ec6a3e3288ff3b
      size: 3971
    - path: libs/binsense/dataprep/embedding_util.py
      hash: md5
      md5: b90cbe1e952b7a1413158d97c4b21725
      size: 5622
    params:
      params.yaml:
        generate_embeds:
          batch_size: 8
          dl_workers: 10
          bbox_labels_estimate: 2000
    outs:
    - path: data/bin/embed_store
      hash: md5
      md5: 41abdcf3e401dc388dac740495655e03.dir
      size: 182321
      nfiles: 8
    - path: data/bin/sample_crops_images.png
      hash: md5
      md5: d860b3b933efd787f7468b775a8da497
      size: 130658
  owl_train_dataprep:
    cmd: python -m binsense.cli.owlv2.train --build_dataset
    deps:
    - path: data/bin/embed_store
      hash: md5
      md5: 41abdcf3e401dc388dac740495655e03.dir
      size: 182321
      nfiles: 8
    - path: data/bin/filtered_dataset
      hash: md5
      md5: e9eac410c3a29cdffeeb31f49d66efa6.dir
      size: 2605489
      nfiles: 183
    - path: libs/binsense/cli/owlv2/train.py
      hash: md5
      md5: 64ff2ca3dfe155fa14fbf1632cf08209
      size: 11859
    - path: libs/binsense/lightning/dataset.py
      hash: md5
      md5: 23c8629da2cad887f30d7c6b4cd2cc64
      size: 14447
    params:
      params.yaml:
        train:
          pos_neg_dataset_ratio: 98
          manual_seed: 1234
          batch_size: 8
          profiler: simple
          dl_workers: 10
          min_epochs: 1
          max_epochs: 30
    outs:
    - path: data/bin/inimage_queries.csv
      hash: md5
      md5: e505ce9fe93654cb8ed063602c80d038
      size: 71142
    - path: data/bin/train_dataset_stats.txt
      hash: md5
      md5: e26d23d7dbc6db3765ae18b5f3e4f2aa
      size: 1021
  owl_test_baseline:
    cmd: python -m binsense.cli.owlv2.train --test --experiment_version=testbaseline
      --accelerator=$TORCH_DEVICE
    deps:
    - path: data/bin/embed_store
      hash: md5
      md5: 41abdcf3e401dc388dac740495655e03.dir
      size: 182321
      nfiles: 8
    - path: data/bin/filtered_dataset
      hash: md5
      md5: e9eac410c3a29cdffeeb31f49d66efa6.dir
      size: 2605489
      nfiles: 183
    - path: data/bin/inimage_queries.csv
      hash: md5
      md5: e505ce9fe93654cb8ed063602c80d038
      size: 71142
    - path: libs/binsense/cli/owlv2/train.py
      hash: md5
      md5: 64ff2ca3dfe155fa14fbf1632cf08209
      size: 11859
    - path: libs/binsense/lightning/config.py
      hash: md5
      md5: 1bb38406422b0a1f94a81a6d84c80ed2
      size: 1728
    params:
      params.yaml:
        train:
          pos_neg_dataset_ratio: 98
          manual_seed: 1234
          batch_size: 8
          profiler: simple
          dl_workers: 10
          min_epochs: 1
          max_epochs: 30
    outs:
    - path: data/bin/testresults_testbaseline.csv
      hash: md5
      md5: 3fe039a7a6d56f6f549379cb8b53339b
      size: 26137
