schema: '2.0'
stages:
  download_data:
    cmd: python -m binsense.cli.run_rawdata_downloader
    deps:
    - path: libs/binsense/cli/run_rawdata_downloader.py
      hash: md5
      md5: 4ccf0e383f9e89f307c96d80b2374b2f
      size: 1222
    - path: libs/binsense/dataprep/config.py
      hash: md5
      md5: 9542da7c91ca5ae874485b0c93cd9e2e
      size: 3206
    - path: libs/binsense/dataprep/downloader.py
      hash: md5
      md5: 4458af72b0a2fd615c0a3802716dfee6
      size: 4828
    - path: libs/binsense/dataprep/metadata.py
      hash: md5
      md5: 6322555564a952d07c79324794e22c0e
      size: 8832
    - path: libs/binsense/resources/ik_data_index.csv
      hash: md5
      md5: 461cd9f78f14ec5a16bcc0a4e1712cb9
      size: 25399
    params:
      params.yaml:
        data_download:
          num_workers: 10
    outs:
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 108ba75b6d5e1e87391c3cabe7b38d4a
      size: 160334
    - path: data/bin/s3/downloader_mark.dat
      hash: md5
      md5: 381f9ce94c0bd239f686028fc846d6ec
      size: 10
    - path: data/bin/s3/images
      hash: md5
      md5: b2d5b563d1a18c89545a00fe82da29fc.dir
      size: 267582252
      nfiles: 3875
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 5253dc34d9b4b0c828e4a85879c742c9
      size: 1934482
    - path: data/bin/s3/metadata
      hash: md5
      md5: 63b4bd975c4ba4b2afddd4f00547969f.dir
      size: 7870101
      nfiles: 3875
  extract_products:
    cmd: python -m binsense.cli.run_extract_products
    deps:
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 108ba75b6d5e1e87391c3cabe7b38d4a
      size: 160334
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 5253dc34d9b4b0c828e4a85879c742c9
      size: 1934482
    - path: libs/binsense/cli/run_extract_products.py
      hash: md5
      md5: f7ec51f578ccd269708caac045d3907b
      size: 973
    - path: libs/binsense/dataprep/config.py
      hash: md5
      md5: 9542da7c91ca5ae874485b0c93cd9e2e
      size: 3206
    outs:
    - path: data/bin/products.csv
      hash: md5
      md5: 70b855ead23e15019a87c2f49a8959eb
      size: 501670
  owl_handpick_data_split:
    cmd: python -m binsense.cli.owlv2.run_handpick_predataprep1
    deps:
    - path: data/bin/handpicked_bins.txt
      hash: md5
      md5: 426bb7fb4a3a445a80a855a3cb553d66
      size: 643
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 108ba75b6d5e1e87391c3cabe7b38d4a
      size: 160334
    - path: data/bin/s3/images
      hash: md5
      md5: b2d5b563d1a18c89545a00fe82da29fc.dir
      size: 267582252
      nfiles: 3875
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 5253dc34d9b4b0c828e4a85879c742c9
      size: 1934482
    - path: libs/binsense/cli/owlv2/run_handpick_predataprep1.py
      hash: md5
      md5: 6f4d70c5cfc983bc407b267e29a10d0c
      size: 8916
    params:
      params.yaml:
        data_split:
          manual_seed: 91634
    outs:
    - path: data/bin/handpick_train_test_dist.png
      hash: md5
      md5: 72629fe094bf362f5020bc5027766ee6
      size: 31329
    - path: data/bin/handpick_train_test_samples.png
      hash: md5
      md5: fb47995f55f8d1e10183ebc562366a3c
      size: 415367
    - path: data/bin/train_test_val_split_item.csv
      hash: md5
      md5: b53c4eaa26003d51b35738e977b884a1
      size: 5186
  owl_handpick_data_preannotate:
    cmd: python -m binsense.cli.owlv2.run_handpick_predataprep2 --device=$TORCH_DEVICE
      --annotate --create_dataset --upload_dataset
    deps:
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 108ba75b6d5e1e87391c3cabe7b38d4a
      size: 160334
    - path: data/bin/s3/images
      hash: md5
      md5: b2d5b563d1a18c89545a00fe82da29fc.dir
      size: 267582252
      nfiles: 3875
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 5253dc34d9b4b0c828e4a85879c742c9
      size: 1934482
    - path: data/bin/train_test_val_split_item.csv
      hash: md5
      md5: b53c4eaa26003d51b35738e977b884a1
      size: 5186
    - path: libs/binsense/cli/owlv2/run_handpick_predataprep2.py
      hash: md5
      md5: 40598dde9628dcff72ea6b35e5de7ea7
      size: 3334
    - path: libs/binsense/dataprep/preannotate.py
      hash: md5
      md5: 464b29115bfe5d80ab8eb8182260e007
      size: 10688
    params:
      params.yaml:
        preannotate:
          batch_size: 8
          dl_workers: 10
    outs:
    - path: data/bin/data_for_annotators.csv
      hash: md5
      md5: 1f8fca0794899da8296dd74d87912b11
      size: 1831874
    - path: data/bin/robo_upload
      hash: md5
      md5: 90a8dfa26de0262805aa81d9329dc6e5.dir
      size: 6540431
      nfiles: 189
    - path: data/bin/sample_preannotated_images.png
      hash: md5
      md5: c255d62d309c935028e35b52b6be514a
      size: 5524676
  owl_handpick_data_download:
    cmd: python -m binsense.cli.owlv2.run_handpick_dataprep1 --download --api_key=$BINSEG_ROBOFLOW_API_KEY
    deps:
    - path: data/bin/handpick_annotation_available.txt
      hash: md5
      md5: 0f65f8bf756e8e788316e1e6ff82d906
      size: 123
    - path: libs/binsense/cli/owlv2/run_handpick_dataprep1.py
      hash: md5
      md5: 52e289116be997bd84b987912dc2a111
      size: 4144
    params:
      params.yaml:
        binseg_roboflow:
          workspace: nitesh-c-eszzc
          project: binsense_segments_100
          dataver: 3
    outs:
    - path: data/bin/robo_download
      hash: md5
      md5: ff2585fed24d4830eab8786d6b943a95.dir
      size: 2563510
      nfiles: 185
    - path: data/bin/sample_gt_annotation_images.png
      hash: md5
      md5: e529835ca17ef9e91de85b685a992610
      size: 664310
  owl_handpick_data_prepare:
    cmd: python -m binsense.cli.owlv2.run_handpick_dataprep2 --validate --copy
    deps:
    - path: data/bin/robo_download
      hash: md5
      md5: ff2585fed24d4830eab8786d6b943a95.dir
      size: 2563510
      nfiles: 185
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 108ba75b6d5e1e87391c3cabe7b38d4a
      size: 160334
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 5253dc34d9b4b0c828e4a85879c742c9
      size: 1934482
    - path: data/bin/train_test_val_split_item.csv
      hash: md5
      md5: b53c4eaa26003d51b35738e977b884a1
      size: 5186
    - path: data/bin/train_test_val_split_item_corrections.csv
      hash: md5
      md5: 351796931cc9d975af69f413cd5243f1
      size: 94
    - path: libs/binsense/cli/owlv2/run_handpick_dataprep2.py
      hash: md5
      md5: 5b6829480bd03de2dfd136d4687de21d
      size: 6734
    outs:
    - path: data/bin/downloaded_data_valid_results.txt
      hash: md5
      md5: a211140754cf15e7ceb62c0e05f1fd18
      size: 125
    - path: data/bin/filtered_dataset
      hash: md5
      md5: 8d9b01d2d9accbcc6f7ee102d1be0825.dir
      size: 2605515
      nfiles: 183
  owl_handpick_data_genembeds:
    cmd: python -m binsense.cli.owlv2.run_handpick_dataprep3 --generate_embeds --accelerator=$LT_ACCELERATOR
    deps:
    - path: data/bin/filtered_dataset
      hash: md5
      md5: 8d9b01d2d9accbcc6f7ee102d1be0825.dir
      size: 2605515
      nfiles: 183
    - path: libs/binsense/cli/owlv2/run_handpick_dataprep3.py
      hash: md5
      md5: 0d1aa059ba94ad7261ec6a3e3288ff3b
      size: 3971
    - path: libs/binsense/dataprep/embedding_util.py
      hash: md5
      md5: b90cbe1e952b7a1413158d97c4b21725
      size: 5622
    params:
      params.yaml:
        generate_embeds:
          batch_size: 8
          dl_workers: 10
          bbox_labels_estimate: 2000
    outs:
    - path: data/bin/embed_store
      hash: md5
      md5: 932fb7eebc749bb43787ba669c1e0d30.dir
      size: 182321
      nfiles: 8
    - path: data/bin/sample_crops_images.png
      hash: md5
      md5: 9a1f246739638849f79afc246e1f7404
      size: 142777
  owl_train_dataprep:
    cmd: python -m binsense.cli.owlv2.train --build_dataset
    deps:
    - path: data/bin/embed_store
      hash: md5
      md5: 932fb7eebc749bb43787ba669c1e0d30.dir
      size: 182321
      nfiles: 8
    - path: data/bin/filtered_dataset
      hash: md5
      md5: 8d9b01d2d9accbcc6f7ee102d1be0825.dir
      size: 2605515
      nfiles: 183
    - path: libs/binsense/cli/owlv2/train.py
      hash: md5
      md5: 5dcf448b66fc5b0faed41f19cf5f9a15
      size: 12424
    - path: libs/binsense/lightning/dataset.py
      hash: md5
      md5: de8ce360cead40aef9ba0e017843503e
      size: 14530
    params:
      params.yaml:
        train:
          pos_neg_dataset_ratio: 98
          manual_seed: 1234
          batch_size: 8
          profiler: simple
          dl_workers: 10
          min_epochs: 1
          max_epochs: 30
          log_every_n_steps: 10
          early_stopping: true
    outs:
    - path: data/bin/inimage_queries.csv
      hash: md5
      md5: f1731d90c4ff889d82da20cacdbf2796
      size: 70449
    - path: data/bin/train_dataset_stats.txt
      hash: md5
      md5: b510bedd0f5078a9e6d61925633d933f
      size: 1053
  owl_test_baseline:
    cmd: python -m binsense.cli.owlv2.train --test --experiment_version=testbaseline
      --accelerator=$LT_ACCELERATOR
    deps:
    - path: data/bin/embed_store
      hash: md5
      md5: 932fb7eebc749bb43787ba669c1e0d30.dir
      size: 182321
      nfiles: 8
    - path: data/bin/filtered_dataset
      hash: md5
      md5: 8d9b01d2d9accbcc6f7ee102d1be0825.dir
      size: 2605515
      nfiles: 183
    - path: data/bin/inimage_queries.csv
      hash: md5
      md5: f1731d90c4ff889d82da20cacdbf2796
      size: 70449
    - path: libs/binsense/cli/owlv2/train.py
      hash: md5
      md5: 5dcf448b66fc5b0faed41f19cf5f9a15
      size: 12424
    - path: libs/binsense/lightning/config.py
      hash: md5
      md5: bcf43a0eeea1c43f25bb419cf92e6bd2
      size: 1775
    params:
      params.yaml:
        train:
          pos_neg_dataset_ratio: 98
          manual_seed: 1234
          batch_size: 8
          profiler: simple
          dl_workers: 10
          min_epochs: 1
          max_epochs: 30
          log_every_n_steps: 10
          early_stopping: true
    outs:
    - path: data/bin/testresults_testbaseline.csv
      hash: md5
      md5: 27d024291ef729842c1676a948195fa2
      size: 27588
    - path: metrics/bin/test_confusion_matrix.png
      hash: md5
      md5: 0a717faa5f28c7c3529c5e4f012d45f5
      size: 24360
  owl_extract_embeddedproducts:
    cmd: python -m binsense.cli.owlv2.run_extract_embedded_products
    deps:
    - path: data/bin/embed_store
      hash: md5
      md5: 932fb7eebc749bb43787ba669c1e0d30.dir
      size: 182321
      nfiles: 8
    - path: data/bin/s3/bins.csv
      hash: md5
      md5: 108ba75b6d5e1e87391c3cabe7b38d4a
      size: 160334
    - path: data/bin/s3/items.csv
      hash: md5
      md5: 5253dc34d9b4b0c828e4a85879c742c9
      size: 1934482
    - path: libs/binsense/cli/owlv2/run_extract_embedded_products.py
      hash: md5
      md5: b58b0ab1ec5c8196b103fd5fddbf9331
      size: 1314
    - path: libs/binsense/dataprep/config.py
      hash: md5
      md5: 9542da7c91ca5ae874485b0c93cd9e2e
      size: 3206
    outs:
    - path: data/bin/embedded_products.csv
      hash: md5
      md5: 7a2cef39defec1382f291f37367f7801
      size: 7769
  owl_train:
    cmd: python -m binsense.cli.owlv2.train --train --experiment_version=$EXP_VER
      --accelerator=$LT_ACCELERATOR
    deps:
    - path: data/bin/embed_store
      hash: md5
      md5: 932fb7eebc749bb43787ba669c1e0d30.dir
      size: 182321
      nfiles: 8
    - path: data/bin/filtered_dataset
      hash: md5
      md5: 8d9b01d2d9accbcc6f7ee102d1be0825.dir
      size: 2605515
      nfiles: 183
    - path: data/bin/inimage_queries.csv
      hash: md5
      md5: f1731d90c4ff889d82da20cacdbf2796
      size: 70449
    - path: libs/binsense/cli/owlv2/train.py
      hash: md5
      md5: 5dcf448b66fc5b0faed41f19cf5f9a15
      size: 12424
    - path: libs/binsense/lightning/config.py
      hash: md5
      md5: bcf43a0eeea1c43f25bb419cf92e6bd2
      size: 1775
    params:
      params.yaml:
        train:
          pos_neg_dataset_ratio: 98
          manual_seed: 1234
          batch_size: 8
          profiler: simple
          dl_workers: 10
          min_epochs: 20
          max_epochs: 100
          log_every_n_steps: 10
          early_stopping: true
    outs:
    - path: metrics/bin/train_last_losses_metrics.csv
      hash: md5
      md5: 4cc35d4ca1af9ed81749125d52597297
      size: 269
    - path: metrics/bin/val_confusion_matrix.png
      hash: md5
      md5: e47674bd2ee33f4cd882375ee464ec25
      size: 23635
    - path: metrics/bin/val_last_losses_metrics.csv
      hash: md5
      md5: 2cbb0311c88c8c9aeba414ab70a75ce7
      size: 250
